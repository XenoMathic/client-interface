<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PharmaGO - Votre assistant pharmacie</title>
  <style>
    :root{--primary:#0069d9;--accent:#ff6f61;--bg:#f0f4f8;--card:#fff;--border:#d1e3f0;--text:#1f2d3d;--radius:12px;--spacing:1rem;--shadow:0 4px 16px rgba(0,0,0,0.1);--speed:.3s;}
    *,*::before,*::after{box-sizing:border-box;margin:0;padding:0;}
    body{font-family:'Segoe UI',Arial,sans-serif;color:var(--text);background:var(--bg);}
    header{display:flex;justify-content:space-between;align-items:center;padding:1rem 2rem;background:var(--card);box-shadow:var(--shadow);position:sticky;top:0;z-index:100;}
    header h1{font-size:1.5rem;color:var(--primary);}
    nav a{margin-left:1rem;padding:.5rem 1rem;border-radius:var(--radius);border:1px solid var(--primary);color:var(--primary);text-decoration:none;transition:background var(--speed),color var(--speed);}    
    nav a:hover{background:var(--primary);color:#fff;}
    .hero{padding:4rem 2rem;text-align:center;background:url('https://source.unsplash.com/1600x900/?pharmacy,health') no-repeat center/cover;color:#fff;position:relative;}
    .hero::before{content:'';position:absolute;inset:0;background:rgba(0,0,0,0.6);}
    .hero-content{position:relative;max-width:800px;margin:0 auto;color:#fff;}
    .hero-content p{margin-top:1rem;font-size:1.2rem;}
    #auth{display:none;padding:2rem;}
    .form-card{max-width:400px;margin:2rem auto;background:var(--card);padding:2rem;border-radius:var(--radius);box-shadow:var(--shadow);}
    .form-card h2{text-align:center;margin-bottom:1rem;color:var(--primary);}
    .form-card input{width:100%;padding:.75rem;margin-bottom:1rem;border:1px solid var(--border);border-radius:var(--radius);transition:border var(--speed);}    
    .form-card input:focus{border-color:var(--primary);outline:none;}
    .form-card button{width:100%;padding:.75rem;background:var(--accent);border:none;color:#fff;font-weight:600;border-radius:var(--radius);cursor:pointer;transition:transform var(--speed);}    
    .form-card button:hover{transform:translateY(-2px);box-shadow:0 8px 24px rgba(0,0,0,0.15);}  
    #app{display:none;}
    .container{width:90%;max-width:1200px;margin:2rem auto;background:var(--card);padding:var(--spacing);border-radius:var(--radius);box-shadow:var(--shadow);}
    .tabs{display:grid;grid-template-columns:repeat(auto-fit,minmax(100px,1fr));gap:.5rem;margin-bottom:var(--spacing);}
    .tab{padding:var(--spacing);text-align:center;background:var(--primary);color:#fff;border-radius:var(--radius);cursor:pointer;transition:background var(--speed);}    
    .tab.active,.tab:hover{background:var(--accent);}    
    .content-section{display:none;animation:fadeIn var(--speed) ease-in;}    
    .content-section.active{display:block;}    
    @keyframes fadeIn{from{opacity:0;}to{opacity:1;}}
    .card{background:var(--card);padding:var(--spacing);border:1px solid var(--border);border-radius:var(--radius);box-shadow:var(--shadow);margin-bottom:var(--spacing);}    
    #mapEmbed{width:100%;height:300px;border:1px solid var(--border);border-radius:var(--radius);overflow:hidden;}
    .paste-btn{margin-bottom:1rem;padding:.5rem 1rem;background:var(--accent);border:none;color:#fff;border-radius:var(--radius);cursor:pointer;}
  </style>
</head>
<body>
  <header>
    <h1>PharmaGO</h1>
    <nav>
      <a href="#" id="link-login">Se connecter</a>
      <a href="#" id="link-register">Créer un compte</a>
    </nav>
  </header>

  <section class="hero" id="hero-section">
    <div class="hero-content">
      <h2>Votre assistant pharmacie</h2>
      <p>PharmaGO vous aide à décoder vos ordonnances, trouver la pharmacie la plus proche et gérer votre historique en toute simplicité.</p>
    </div>
  </section>

  <section id="auth">
    <div class="form-card">
      <h2 id="form-title">Se connecter</h2>
      <form id="authForm">
        <input type="text" id="username" placeholder="Nom d'utilisateur" required>
        <input type="password" id="password" placeholder="Mot de passe" required>
        <input type="password" id="confirm" placeholder="Confirmer le mot de passe" style="display:none;">
        <button type="submit" id="authButton">Se connecter</button>
      </form>
    </div>
  </section>

  <section id="app">
    <div class="container">
      <h2>Bonjour, <span id="displayUsername"></span> !</h2>
      <div class="tabs" id="tabs">
        <div class="tab active" data-target="profile">Mes Ordonnances</div>
        <div class="tab" data-target="ordonnance">Décodage</div>
        <div class="tab" data-target="pharmacie">Pharmacie</div>
        <div class="tab" data-target="logout">Déconnexion</div>
      </div>
      <div id="profile" class="content-section active">
        <h3>Historique</h3>
        <div id="profileOrdos"></div>
      </div>
      <div id="ordonnance" class="content-section">
        <h3>Décoder une ordonnance</h3>
        <button class="paste-btn" id="pasteBtn">Coller le code</button>
        <textarea id="codeInput" placeholder="Les 12 premiers caractères" style="width:100%;min-height:100px;"></textarea>
        <div id="hiddenCode" style="display:none;"></div>
        <button id="decodeBtn" style="margin-top:1rem;">Décoder</button>
        <div id="codeResult"></div>
      </div>
      <div id="pharmacie" class="content-section">
        <h3>Pharmacie la plus proche</h3>
        <button id="locatePharmacy">Afficher la carte</button>
        <div id="mapEmbed" style="margin-top:1rem;"></div>
      </div>
      <div id="logout" class="content-section">
        <button id="logoutBtn">Se déconnecter</button>
      </div>
    </div>
  </section>

  <script>
    // Éléments globaux
    const heroSection = document.getElementById('hero-section');
    const authSection = document.getElementById('auth');
    const appSection = document.getElementById('app');
    const linkLogin = document.getElementById('link-login');
    const linkRegister = document.getElementById('link-register');
    const formTitle = document.getElementById('form-title');
    const authForm = document.getElementById('authForm');
    const authButton = document.getElementById('authButton');
    const confirmInput = document.getElementById('confirm');
    const displayUsername = document.getElementById('displayUsername');
    let registerMode = false;

    // Afficher le formulaire d'authentification
    function showAuth() {
      heroSection.style.display = 'none';
      authSection.style.display = 'block';
    }
    linkLogin.addEventListener('click', e => {
      e.preventDefault();
      registerMode = false;
      formTitle.textContent = 'Se connecter';
      authButton.textContent = 'Se connecter';
      confirmInput.style.display = 'none';
      showAuth();
    });
    linkRegister.addEventListener('click', e => {
      e.preventDefault();
      registerMode = true;
      formTitle.textContent = 'Créer un compte';
      authButton.textContent = 'Créer un compte';
      confirmInput.style.display = 'block';
      showAuth();
    });

    // Logique d'authentification
    authForm.addEventListener('submit', e => {
      e.preventDefault();
      const user = document.getElementById('username').value.trim();
      const pass = document.getElementById('password').value;
      if (!user || !pass) {
        return alert('Tous les champs sont requis.');
      }
      if (registerMode) {
        const conf = confirmInput.value;
        if (pass.length < 6) {
          return alert('Le mot de passe doit contenir au moins 6 caractères.');
        }
        if (pass !== conf) {
          return alert('Les mots de passe ne correspondent pas.');
        }
        localStorage.setItem('user_' + user, JSON.stringify({ password: pass }));
        localStorage.setItem('ordonnances_' + user, JSON.stringify([]));
      } else {
        const stored = JSON.parse(localStorage.getItem('user_' + user) || 'null');
        if (!stored || stored.password !== pass) {
          return alert('Identifiants invalides.');
        }
      }
      // Succès
      displayUsername.textContent = user;
      document.querySelector('header nav').style.display = 'none';
      authSection.style.display = 'none';
      appSection.style.display = 'block';
      initApp(user);
    });

    // Initialisation de l'app
    function initApp(user) {
      initTabs();
      loadProfileOrdos(user);
      initDecode(user);
      initMap();
      initLogout();
    }

    // Gestion des onglets
    function initTabs() {
      document.querySelectorAll('.tab').forEach(tab => {
        tab.addEventListener('click', () => {
          document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
          document.querySelectorAll('.content-section').forEach(s => s.classList.remove('active'));
          tab.classList.add('active');
          document.getElementById(tab.dataset.target).classList.add('active');
        });
      });
    }

    // Chargement de l'historique
        // Chargement de l'historique
    function loadProfileOrdos(user) {
      const div = document.getElementById('profileOrdos');
      div.innerHTML = '';
      const listKey = 'ordonnances_' + user;
      const list = JSON.parse(localStorage.getItem(listKey) || '[]');
      list.forEach((ord, i) => {
        const card = document.createElement('div');
        card.className = 'card';
        let html = `<h4>#${i + 1} - ${ord.date}</h4>
                    <p><strong>ID :</strong> ${ord.id}</p>
                    <p><strong>Patient :</strong> ${ord.patient}</p>
                    <ul>`;
        ord.prescription.forEach(item => {
          html += `<li>
                     <strong>Médicament :</strong> ${item.medicament}<br>
                     <strong>Nom commercial :</strong> ${item.nomCommercial}<br>
                     <strong>Fréquence :</strong> ${item.frequence}x/j<br>
                     <strong>Durée :</strong> ${item.duree}j
                   </li>`;
        });
        html += '</ul>';
        // Ajout du bouton supprimer
        html += `<button class="action delete-btn" data-index="${i}" style="margin-top:1rem;">Supprimer</button>`;
        card.innerHTML = html;
        div.append(card);
      });
      // Ajout des gestionnaires pour suppression
      document.querySelectorAll('.delete-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          const idx = parseInt(btn.getAttribute('data-index'));
          list.splice(idx, 1);
          localStorage.setItem(listKey, JSON.stringify(list));
          loadProfileOrdos(user);
        });
      });
    }

    // Décodage d'ordonnance
    function initDecode(user) {
      const pasteBtn = document.getElementById('pasteBtn');
      const codeInput = document.getElementById('codeInput');
      const hiddenCode = document.getElementById('hiddenCode');
      pasteBtn.addEventListener('click', async () => {
        try {
          const text = (await navigator.clipboard.readText()).trim();
          hiddenCode.textContent = text;
          codeInput.value = text.slice(0, 12);
        } catch {
          alert('Impossible de coller');
        }
      });
      document.getElementById('decodeBtn').addEventListener('click', () => {
        const full = hiddenCode.textContent;
        if (!full) return alert('Collez d\'abord un code');
        try {
          const obj = JSON.parse(atob(full.slice(12)));
          obj.date = new Date().toLocaleDateString();
          obj.id = full.slice(0, 12);
          const listKey = 'ordonnances_' + user;
          const list = JSON.parse(localStorage.getItem(listKey) || '[]');
          list.push(obj);
          localStorage.setItem(listKey, JSON.stringify(list));
          loadProfileOrdos(user);
          document.getElementById('codeResult').innerHTML = `
            <div class="card">
              <h4>Ordonnance décodée</h4>
              <p><strong>ID :</strong> ${obj.id}</p>
              <ul>${obj.prescription.map(it => `<li>${it.medicament} - ${it.frequence}x/j</li>`).join('')}</ul>
            </div>`;
        } catch {
          alert('Code invalide');
        }
      });
    }

    // Carte
    function initMap() {
      document.getElementById('locatePharmacy').addEventListener('click', () => {
        const m = document.getElementById('mapEmbed');
        m.textContent = 'Chargement...';
        if (!navigator.geolocation) {
          m.textContent = 'Géolocalisation non supportée.';
          return;
        }
        navigator.geolocation.getCurrentPosition(
          pos => {
            const { latitude, longitude } = pos.coords;
            m.innerHTML = `<iframe src="https://maps.google.com/maps?q=pharmacie&ll=${latitude},${longitude}&z=15&output=embed" width="100%" height="100%" style="border:0;" allowfullscreen loading="lazy"></iframe>`;
          },
          () => {
            m.textContent = 'Localisation impossible.';
          }
        );
      });
    }

    // Déconnexion
    function initLogout() {
      document.getElementById('logoutBtn').addEventListener('click', () => location.reload());
    }
  </script>
</body>
</html>
